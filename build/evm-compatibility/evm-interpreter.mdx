---
title: "EVM Bytecode Interpreter"
description: "How Sophon's EVM equivalence module works"
---

# EVM Bytecode Interpreter

The **EVM Bytecode Interpreter** is a key component of Sophon's **v27 upgrade**, enabling true **EVM equivalence** by allowing the direct execution of unmodified EVM bytecode on Sophon's zkEVM. With this upgrade, you can deploy your unmodified Solidity contracts in exactly the same way as on Ethereum, but with **higher gas fees** than native ZKsync VM bytecode.

## What is EVM Equivalence?

**EVM equivalence** means that a blockchain can execute standard EVM bytecode directly, providing:

- **Identical behavior** to Ethereum's EVM in all aspects
- **Identical address derivation** for contract deployments
- **Full compatibility** with standard Ethereum development tools
- **No requirement** for special compilation or adaptation

This is different from mere "EVM compatibility," which typically requires specialized tooling or compilation steps.

## What is the EVM Bytecode Interpreter?

The **EVM Bytecode Interpreter** is a specialized system component that allows Sophon to:

- **Execute standard EVM bytecode** without modification or recompilation
- **Bridge the gap** between Ethereum's EVM and Sophon's zkEVM
- **Support standard Ethereum development tools** without specialized plugins or adaptations

This represents a significant advancement beyond the previous approach of requiring zkEVM-specific compilation.

## How the EVM Bytecode Interpreter Works

The **EVM Bytecode Interpreter** serves as a crucial system contract that enables the execution of standard EVM bytecode on Sophon's zkEVM, ensuring EVM equivalence. This involves:

1. **Effortless Contract Deployment**: Deploy contracts just as you would on Ethereum, using transactions without a `to` field and embedding contract initialization code as calldata. This process guarantees identical address derivation and behavior as on Ethereum.
2. **Comprehensive Tool Compatibility**: Utilize standard Ethereum development tools like Hardhat and Foundry without needing additional plugins or modifications, facilitating a seamless transition for developers accustomed to the Ethereum ecosystem.
3. **Transparent Execution**: The interpreter operates behind the scenes, invoked automatically by the protocol, so developers can focus on their code without extra steps.

Contracts deployed in this manner are flagged as EVM bytecode and executed through the EVM interpreter. During execution, the contract’s EVM opcodes are translated into the ZKsync VM’s instruction set and executed by the ZKsync VM. However, this translation process results in gas fees that are **150-400% higher** than those for contracts deployed using native ZKsync VM bytecode. Therefore, this approach is recommended only for use cases that require specific EVM features not supported by the ZKsync VM (see EVM differences).

![Contract Deployment](/images/evm-equivalence/contract-deployment.png)

## Versioned Contract Storage

Contracts in Sophon are identified through their **"versioned hash"** in the `AccountCodeStorage`:

- **zkEVM contracts**: Version `0x01`
- **EVM contracts**: Version `0x02`

You can check if a contract was deployed with EVM bytecode by calling the `isAccountEVM(address)` function on the `AccountCodeStorage` system contract at `0x0000000000000000000000000000000000008002`.

## Benefits for Developers

**EVM equivalence** provides significant advantages for developers:

- **Standard Solidity/Vyper Deployment**: Deploy contracts compiled with standard Solidity/Vyper compilers
- **Same Address Derivation**: Get the same contract addresses from `create` and `create2` as on Ethereum
- **Familiar Debugging**: Use standard Ethereum debugging tools with deployed contracts
- **Cross-VM Interoperability**: EVM and zkEVM contracts can interact (with some limitations)
- **Simplified Migration**: Move existing Ethereum contracts to Sophon without code changes
- **Familiar Tooling**: Use existing Ethereum tools and workflows without adaptation
- **Consistent Testing**: Test contracts in the same way as on Ethereum
- **Code Reuse**: Leverage existing libraries and patterns without modification

## Technical Details

### EVM Version Support

The EVM bytecode interpreter targets the **Cancun** EVM version.

### Gas Model

The **gas model** in Sophon differs slightly from Ethereum:

- The EVM interpreter uses a **fixed ratio (5:1)** to derive EVM gas from native zkEVM gas (ergs)
- `block.gaslimit` returns `1125899906842624n` directly from underlying zkEVM, which differs from the value returned by EVM chains (`36000000n`)
- Different gas costs for certain operations due to the ZK-proof generation overhead
- **150-400% higher gas fees** than those for contracts deployed using native ZKsync VM bytecode

### Contract Interaction Limitations

There are some limitations when EVM and zkEVM contracts interact:

- **`delegatecall` is not supported between EVM and zkEVM contracts** due to execution model differences
- Out-of-gas handling differs depending on whether it's EVM gas or native zkEVM gas

## Development Considerations

When developing for Sophon using the **EVM Bytecode Interpreter**:

1. **Verification**: Contract verification must be done using Sophon's native block explorer API
2. **L1-L2 Transactions**: EVM contracts can't be deployed directly via L1-L2 transactions, but you can use factory contracts
3. **Foundry Scripts**: When using Foundry scripts, use the `--skip-simulation` flag due to differences in gas models

## The Road to Full EVM Equivalence

While the **v27 upgrade** with the **EVM Bytecode Interpreter** brings Sophon much closer to true EVM equivalence, complete equivalence is expected with the next proving system. The current implementation covers most developers' needs but does have some limitations due to the underlying zkEVM architecture.

## FAQ About EVM Equivalence

**Q: Can I use standard Hardhat and Foundry with Sophon?**  
A: Yes, with the **v27 upgrade**, you can use standard Hardhat without plugins. For Foundry scripts, use the `--skip-simulation` flag.

**Q: Is contract verification different for EVM contracts on Sophon?**  
A: Yes, contract verification must be done using Sophon's native block explorer API.

**Q: Can EVM contracts interact with zkEVM contracts?**  
A: Yes, they can interact via standard calls, though `delegatecall` is not supported between them.

**Q: Is the gas model identical to Ethereum?**  
A: Not completely. While the **EVM Bytecode Interpreter** handles gas conversion, there are still some differences in gas costs for certain operations due to the ZK-proof overhead.
